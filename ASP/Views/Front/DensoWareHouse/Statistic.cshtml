@{
    ViewData["Title"] = "Delay History Statistics";
    Layout = "../Shared/Layout/Front/_Layout";
}
<div class="container-fluid mt-0 p-0">
    <!-- Controls Card -->
    <div class="card shadow-xl border-0 rounded-3xl overflow-hidden professional-card full-bleed slide-in-left" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); backdrop-filter: blur(20px); position: relative; overflow: hidden;">
        <!-- Subtle background pattern -->
        <div class="bg-pattern"></div>
        <div class="card-body p-3" style="display:flex; flex-direction:column; align-items:flex-start; justify-content:center; min-height:140px; padding-left:4rem; padding-right:1.25rem;">
            <div class="d-flex justify-content-between align-items-center mb-0 animate__animated animate__fadeInDown animate__delay-1s" style="width:100%;">
                <div class="title-section animate__animated animate__fadeInLeft animate__delay-2s me-3" style="margin-left:0; transform: none;">
                    <h2 class="card-title mb-0 fw-bold" style="font-size: 2.2rem; letter-spacing: 1px; color: #000;">
                        <i class="fas fa-chart-line me-3 text-gold"></i>Orders Analytics
                    </h2>
                </div>
                <div class="d-flex align-items-center gap-4 controls-section animate__animated animate__fadeInRight animate__delay-1s">
                    <div class="input-group input-group-sm group-select" id="filterControls" style="width: 320px; background: rgba(255,255,255,0.06); border-radius: 50px; backdrop-filter: blur(10px); padding: 4px;">
                        <span class="input-group-text bg-transparent border-0 text-white"><i class="fas fa-filter text-gold"></i></span>
                        <select id="filterMode" class="form-select border-0 bg-transparent text-white" style="border-radius: 0 50px 50px 0; max-width: 120px;">
                            <option value="month">Month</option>
                            <option value="year">Year</option>
                        </select>    
                        <input type="month" id="monthPicker" class="form-control border-0 bg-transparent text-white" style="max-width:160px; display:none;" />
                        <input type="number" id="yearPicker" class="form-control border-0 bg-transparent text-white" style="max-width:120px; display:none;" min="2000" max="2100" placeholder="Year" />
                    </div>
                    <!-- Customer selector: populated dynamically from orders via JS -->
                    <div class="input-group input-group-sm group-select" style="width: 200px; background: rgba(255,255,255,0.06); border-radius:50px; padding:4px;">
                        <span class="input-group-text bg-transparent border-0 text-white"><i class="fas fa-user text-gold"></i></span>
                        <select id="customerSelect" class="form-select border-0 bg-transparent text-white" style="border-radius: 0 50px 50px 0; max-width: 240px;">
                            <option value="All">All customers</option>
                        </select>
                    </div>
                    <button id="btnLoad" class="btn btn-gold px-5 py-2 shadow-lg" style="border-radius: 50px; border: none; font-weight: 600; letter-spacing: 0.5px;">
                        <i class="fas fa-magic me-2"></i><i class="bi bi-arrow-repeat" style="font-size: 40px;"></i>Filter 
                    </button>
                </div>
            </div>
            <div id="chartError" class="alert alert-warning mt-4 rounded-2xl shadow-sm d-none animate__animated animate__shakeX" role="alert" style="background: rgba(255,193,7,0.2); border: 1px solid rgba(255,193,7,0.3); backdrop-filter: blur(10px);">
                <i class="fas fa-triangle-exclamation me-2 text-warning"></i><span id="errorMsg" class="text-light"></span>
            </div>
        </div>
    </div>
    <!-- KPI Overview Row -->
    <div id="kpiContainer" class="mt-4 d-flex gap-3 flex-wrap justify-content-center"></div>
    <!-- Separate Chart Container -->
    <div class="mt-5 chart-wrapper slide-in-right">
        <!-- Intro / summary for the statistics so users know what the chart shows -->
        <div id="statisticIntro" style="width:50%; max-width:760px; margin-bottom:24px;">
            <div class="card shadow-sm p-3" style="background: rgba(255,255,255,0.02); border: 1px solid rgba(0,0,0,0.04); border-radius:16px;">
                <div class="d-flex flex-column">
                    <h3 class="mb-1 fw-bold text-black" style="font-size:28px; letter-spacing:0.4px;">Order Statistics</h3>
                    <p class="mb-0 text-muted" style="font-size:16px;">Overview — Total orders across all customers</p>
                </div>
            </div>
        </div>
        <div id="chartArea" class="position-relative card shadow-2xl border-0 rounded-3xl overflow-hidden chart-entrance" style="min-height: 600px; background: var(--chart-bg); backdrop-filter: none; position: relative; overflow: hidden;">
            <!-- Chart background pattern -->
            <div class="chart-bg-pattern"></div>
            <!-- New: Scrollable wrapper for canvas to enable horizontal scroll -->
            <div id="chartScroll" style="width: 100%; height: 100%; overflow-x: auto; overflow-y: hidden; padding: 20px 0;">
                <canvas id="delayChart" aria-label="Delay history analytics chart" role="img" style="display: block; min-height: 500px;"></canvas>
            </div>
            <div id="chartSpinner" style="display:none; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:10;">
                <div class="spinner-border spinner-border-xl text-white" role="status" style="width: 4rem; height: 4rem;">
                    <span class="visually-hidden">Analyzing data...</span>
                </div>
                <p class="text-black mt-3 mb-0 fw-semibold" style="text-shadow: 0 1px 2px rgba(0,0,0,0.5) ;">
                    <div class="spinner-text-wrapper" aria-hidden="false">
                        <div class="spinner-text-column" style="display:flex; flex-direction:column; align-items:center; gap:12px;">
                            <span class="typing-text"> Loading Data <span class="ellipsis">...</span></span>
                            <div class="husky" aria-hidden="true">
                                <div class="mane">
                                    <div class="coat"></div>
                                </div>
                                <div class="body">
                                    <div class="head">
                                        <div class="ear"></div>
                                        <div class="ear"></div>
                                        <div class="face">
                                            <div class="eye"></div>
                                            <div class="eye"></div>
                                            <div class="nose"></div>
                                            <div class="mouth">
                                                <div class="lips"></div>
                                                <div class="tongue"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="torso"></div>
                                </div>
                                <div class="legs">
                                    <div class="front-legs">
                                        <div class="leg"></div>
                                        <div class="leg"></div>
                                    </div>
                                    <div class="hind-leg">
                                    </div>
                                </div>
                                <div class="tail">
                                    <div class="tail">
                                        <div class="tail">
                                            <div class="tail">
                                                <div class="tail">
                                                    <div class="tail">
                                                        <div class="tail"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position:absolute">
                            <defs>
                                <filter id="squiggly-0">
                                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="0" />
                                    <feDisplacementMap id="displacement" in="SourceGraphic" in2="noise" scale="2" />
                                </filter>
                                <filter id="squiggly-1">
                                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="1" />
                                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
                                </filter>
                                <filter id="squiggly-2">
                                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="2" />
                                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="2" />
                                </filter>
                                <filter id="squiggly-3">
                                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="3" />
                                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
                                </filter>
                                <filter id="squiggly-4">
                                    <feTurbulence id="turbulence" baseFrequency="0.02" numOctaves="3" result="noise" seed="4" />
                                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="1" />
                                </filter>
                            </defs>
                        </svg>
                    </div>
                </p>
            </div>
        </div>
        <div id="chartLegend" class="mt-5 d-flex flex-wrap gap-3 justify-content-center legend-container animate__animated animate__fadeIn animate__delay-5s"></div>
    </div>
</div>
<!-- External Links -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
<link rel="stylesheet" href="~/css/Statistic.css" />
<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
<script src="~/js/Statistic.js"></script>
<link rel="stylesheet" href="https://public.codepenassets.com/css/normalize-5.0.0.min.css">
<link rel="stylesheet" href="~/css/husky.css">